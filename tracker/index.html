<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SBL Toolkit Â· IT ë‰´ìŠ¤ ì¸ì‚¬ì´íŠ¸ íŠ¸ë˜ì»¤</title>

  <style>
    :root {
      --primary: #3b82f6;
      --primary-dark: #2563eb;
      --success: #10b981;
      --success-dark: #059669;
      --danger: #ef4444;
      --light-bg: #f9fafb;
      --border: #d1d5db;
      --text: #1f2937;
      --text-light: #6b7280;
      --card: #ffffff;
      --shadow: 0 1px 3px rgba(0,0,0,0.1);
      --shadow-hover: 0 4px 6px rgba(0,0,0,0.1);
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell,
        "Open Sans", "Helvetica Neue", sans-serif;
      max-width: 1100px;
      margin: 0 auto;
      padding: 1.25rem 1rem 2rem;
      background: var(--light-bg);
      color: var(--text);
    }

    h1, h2, h3 { margin-bottom: 1rem; }
    h1 {
      font-size: 1.8rem;
      text-align: center;
      margin: 0.75rem 0 1.25rem;
    }

    /* ìƒë‹¨ ë°” */
    .topbar {
      display: flex;
      gap: 0.75rem;
      align-items: center;
      justify-content: space-between;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 10px;
      box-shadow: var(--shadow);
      padding: 0.75rem 1rem;
      margin-bottom: 1rem;
    }
    .brand {
      display: flex;
      flex-direction: column;
      gap: 0.1rem;
    }
    .brand-title {
      font-weight: 800;
      letter-spacing: -0.3px;
    }
    .brand-sub {
      font-size: 0.85rem;
      color: var(--text-light);
    }
    .topbar-actions {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      justify-content: flex-end;
      align-items: center;
    }
    .btn {
      border: 1px solid var(--border);
      background: #fff;
      color: var(--text);
      padding: 0.55rem 0.85rem;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.9rem;
      transition: background-color 0.2s, box-shadow 0.2s, transform 0.1s;
    }
    .btn:hover { background: #f8f9fa; box-shadow: var(--shadow); }
    .btn:active { transform: scale(0.98); }
    .btn-primary {
      border: 1px solid transparent;
      background: var(--primary);
      color: #fff;
    }
    .btn-primary:hover { background: var(--primary-dark); }
    .btn-danger {
      border: 1px solid #fecaca;
      background: #fff5f5;
      color: var(--danger);
    }
    .btn-danger:hover { background: #ffecec; }

    /* ë¡œê·¸ì¸ í™”ë©´ ìŠ¤íƒ€ì¼ */
    .login-container {
      max-width: 420px;
      margin: 4rem auto;
      padding: 2rem;
      background: white;
      border-radius: 10px;
      box-shadow: var(--shadow-hover);
      text-align: center;
      border: 1px solid var(--border);
    }
    .login-title {
      margin-bottom: 1.25rem;
      font-size: 1.45rem;
      font-weight: 800;
    }
    .login-desc {
      color: var(--text-light);
      font-size: 0.95rem;
      line-height: 1.5;
    }
    .login-button {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      background-color: white;
      color: var(--text);
      border: 1px solid var(--border);
      padding: 0.85rem 1rem;
      border-radius: 10px;
      font-size: 1rem;
      cursor: pointer;
      width: 100%;
      transition: background-color 0.2s, box-shadow 0.2s, transform 0.1s;
      font-weight: 700;
      margin-top: 1.25rem;
    }
    .login-button:hover {
      background-color: #f8f9fa;
      box-shadow: var(--shadow);
    }
    .login-button:active { transform: scale(0.99); }
    .login-button img {
      width: 18px;
      height: 18px;
    }

    /* ì‚¬ìš©ì ì •ë³´ í‘œì‹œ */
    .user-profile {
      display: flex;
      align-items: center;
      gap: 1rem;
      background: white;
      padding: 0.75rem 1rem;
      border-radius: 10px;
      box-shadow: var(--shadow);
      margin-bottom: 1rem;
      border: 1px solid var(--border);
    }
    .user-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      object-fit: cover;
    }
    .user-info { flex: 1; }
    .user-name { font-weight: 800; font-size: 0.95rem; }
    .user-email { font-size: 0.8rem; color: var(--text-light); }
    .logout-button {
      background: none;
      border: none;
      color: var(--danger);
      cursor: pointer;
      font-size: 0.9rem;
      padding: 0.25rem 0.5rem;
      font-weight: 800;
    }

    /* ì•± ì»¨í…Œì´ë„ˆ (ë¡œê·¸ì¸ ì „ì—ëŠ” ìˆ¨ê¹€) */
    #appContainer { display: none; }
    /* ë¡œê·¸ì¸ ì»¨í…Œì´ë„ˆ (ë¡œê·¸ì¸ í›„ì—ëŠ” ìˆ¨ê¹€) */
    #loginContainer { display: block; }

    /* íƒ­ ìŠ¤íƒ€ì¼ */
    .tabs {
      display: flex;
      border-bottom: 1px solid var(--border);
      margin-bottom: 1.25rem;
      gap: 0.25rem;
      flex-wrap: wrap;
    }
    .tab {
      padding: 0.75rem 1.25rem;
      cursor: pointer;
      border: none;
      background: transparent;
      font-weight: 800;
      color: var(--text-light);
      border-bottom: 2px solid transparent;
      transition: all 0.2s;
      border-radius: 8px 8px 0 0;
    }
    .tab:hover { background: rgba(59,130,246,0.06); color: var(--text); }
    .tab.active {
      color: var(--primary);
      border-bottom: 2px solid var(--primary);
      background: rgba(59,130,246,0.06);
    }

    /* ì…ë ¥ í¼ */
    .form-container {
      background: white;
      padding: 1.5rem;
      border-radius: 10px;
      box-shadow: var(--shadow);
      margin-bottom: 1.25rem;
      border: 1px solid var(--border);
    }
    .form-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
    }
    .form-group { flex: 1; min-width: 200px; }
    label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 800;
      font-size: 0.9rem;
    }
    input[type="text"],
    input[type="url"],
    input[type="date"],
    select,
    textarea {
      width: 100%;
      padding: 0.65rem 0.8rem;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 1rem;
      box-sizing: border-box;
      background: #fff;
    }
    textarea { resize: vertical; min-height: 90px; }

    .tags-input {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      padding: 0.5rem;
      border: 1px solid var(--border);
      border-radius: 8px;
      min-height: 2.6rem;
      background: #fff;
    }
    .tag {
      background: #e5e7eb;
      padding: 0.25rem 0.75rem;
      border-radius: 16px;
      font-size: 0.85rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-weight: 700;
    }
    .tag-remove { cursor: pointer; font-weight: 900; }
    .tags-input input {
      border: none;
      outline: none;
      flex: 1;
      min-width: 100px;
      font-size: 0.95rem;
      padding: 0.25rem;
      background: transparent;
    }

    button.primary {
      padding: 0.75rem 1.25rem;
      border: none;
      border-radius: 8px;
      background: var(--primary);
      color: white;
      font-weight: 900;
      cursor: pointer;
      transition: background 0.2s, transform 0.1s;
    }
    button.primary:hover { background: var(--primary-dark); }
    button.primary:active { transform: scale(0.98); }

    /* ë‰´ìŠ¤ ì•„ì´í…œ ëª©ë¡ */
    .view-container { display: none; }
    .view-container.active { display: block; }

    .news-filters, .timeline-filters {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      margin-bottom: 1rem;
      padding: 1rem;
      background: white;
      border-radius: 10px;
      box-shadow: var(--shadow);
      align-items: center;
      border: 1px solid var(--border);
    }
    .filter-group {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .filter-group label {
      font-size: 0.85rem;
      margin-bottom: 0;
      font-weight: 900;
      color: var(--text-light);
    }

    .news-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1rem;
    }
    .news-item {
      background: white;
      border-radius: 10px;
      box-shadow: var(--shadow);
      padding: 1rem;
      transition: transform 0.2s, box-shadow 0.2s;
      position: relative;
      border: 1px solid var(--border);
    }
    .news-item:hover {
      transform: translateY(-3px);
      box-shadow: var(--shadow-hover);
    }
    .news-date {
      font-size: 0.8rem;
      color: var(--text-light);
      margin-bottom: 0.5rem;
      font-weight: 700;
    }
    .news-title { font-weight: 900; margin-bottom: 0.75rem; }
    .news-url {
      word-break: break-all;
      font-size: 0.85rem;
      color: var(--primary);
      text-decoration: none;
      margin-bottom: 0.75rem;
      display: block;
      font-weight: 800;
    }
    .news-note {
      font-size: 0.9rem;
      color: var(--text);
      line-height: 1.55;
      margin-top: 0.5rem;
      white-space: normal;
    }
    .news-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-top: 0.75rem;
    }
    .news-tag {
      background: #eef2ff;
      color: #4f46e5;
      padding: 0.25rem 0.5rem;
      border-radius: 6px;
      font-size: 0.78rem;
      cursor: pointer;
      font-weight: 900;
    }
    .news-tag:hover { background: #dbe3ff; }

    .news-actions {
      display: flex;
      justify-content: space-between;
      margin-top: 1rem;
      padding-top: 0.75rem;
      border-top: 1px solid #f0f0f0;
    }
    .action-btn {
      background: none;
      border: none;
      color: var(--text-light);
      cursor: pointer;
      font-size: 0.9rem;
      padding: 0.25rem 0.5rem;
      font-weight: 900;
    }
    .action-btn:hover { color: var(--text); }

    /* íƒ€ì„ë¼ì¸ ë·° */
    .timeline { position: relative; padding: 2rem 0; }
    .timeline::before {
      content: '';
      position: absolute;
      left: 50%;
      top: 0;
      bottom: 0;
      width: 2px;
      background: var(--primary);
      transform: translateX(-50%);
    }
    .timeline-item { position: relative; margin-bottom: 2rem; display: flex; }
    .timeline-item:nth-child(odd) { flex-direction: row; padding-right: 50%; }
    .timeline-item:nth-child(even) { flex-direction: row-reverse; padding-left: 50%; }
    .timeline-dot {
      position: absolute;
      left: 50%;
      top: 1rem;
      width: 16px;
      height: 16px;
      background: var(--primary);
      border-radius: 50%;
      transform: translateX(-50%);
      z-index: 2;
    }
    .timeline-content {
      background: white;
      border-radius: 10px;
      box-shadow: var(--shadow);
      padding: 1rem;
      width: 90%;
      max-width: 500px;
      border: 1px solid var(--border);
    }

    /* ì—°ê´€ ë‰´ìŠ¤ ë·° */
    .clusters-container { display: flex; flex-direction: column; gap: 2rem; }
    .cluster {
      background: white;
      border-radius: 10px;
      box-shadow: var(--shadow);
      padding: 1.5rem;
      border: 1px solid var(--border);
    }
    .cluster-title {
      font-size: 1.25rem;
      margin-bottom: 1rem;
      color: var(--primary);
      font-weight: 900;
    }
    .cluster-items {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1rem;
    }

    /* íƒœê·¸ ë·° */
    .tags-list {
      background: white;
      border-radius: 10px;
      box-shadow: var(--shadow);
      padding: 1.25rem;
      border: 1px solid var(--border);
    }
    .tag-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.65rem 0.5rem;
      border-bottom: 1px solid var(--border);
      gap: 1rem;
    }
    .tag-item:last-child { border-bottom: none; }
    .tag-name { font-weight: 900; }
    .tag-count { color: var(--text-light); font-weight: 800; margin-left: 0.3rem; }
    .tag-delete-btn {
      background: none;
      border: none;
      color: var(--danger);
      cursor: pointer;
      font-size: 0.9rem;
      padding: 0.25rem 0.5rem;
      font-weight: 900;
    }
    .tag-delete-btn:hover { color: #b91c1c; }

    .empty-message {
      text-align: center;
      padding: 2rem;
      color: var(--text-light);
      font-weight: 800;
    }

    /* ë°˜ì‘í˜• */
    @media (max-width: 768px) {
      .timeline::before { left: 20px; }
      .timeline-item {
        padding-left: 50px !important;
        padding-right: 0 !important;
        flex-direction: row !important;
      }
      .timeline-dot { left: 20px; }
      .timeline-content { width: 100%; }

      .news-filters, .timeline-filters {
        flex-direction: column;
        align-items: stretch;
      }
      .filter-group { width: 100%; }
      .filter-group input[type="text"], .filter-group select { width: 100%; }
      .filter-group button { width: 100%; }
      .filter-group[style*="margin-left: auto"] { margin-left: 0 !important; }
      .topbar { flex-direction: column; align-items: stretch; }
      .topbar-actions { justify-content: flex-start; }
    }
  </style>
</head>

<body>
  <!-- ìƒë‹¨ ë°”: SBL Toolkit ê³µí†µ ëŠë‚Œ + í™ˆ ì´ë™ -->
  <div class="topbar">
    <div class="brand">
      <div class="brand-title">ì„¸ì»¨ë“œë¸Œë ˆì¸ì—°êµ¬ì†Œ Â· SBL Toolkit</div>
      <div class="brand-sub">IT ë‰´ìŠ¤ ì¸ì‚¬ì´íŠ¸ íŠ¸ë˜ì»¤ (ê°œì¸ìš©)</div>
    </div>
    <div class="topbar-actions">
      <button class="btn" type="button" onclick="goHome()">ğŸ  í™ˆ</button>
      <button class="btn btn-primary" type="button" onclick="scrollToTop()">â¬†ï¸ ë§¨ìœ„</button>
    </div>
  </div>

  <h1>IT ë‰´ìŠ¤ ì¸ì‚¬ì´íŠ¸ íŠ¸ë˜ì»¤</h1>

  <div id="loginContainer" class="login-container">
    <h2 class="login-title">ë¡œê·¸ì¸í•˜ì—¬ ì‹œì‘í•˜ê¸°</h2>
    <p class="login-desc">
      ê°œì¸í™”ëœ IT ë‰´ìŠ¤ íŠ¸ë˜ì»¤ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ë ¤ë©´ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.<br />
      (í—ˆìš© ê³„ì •: <b>eundang@gmail.com</b>)
    </p>
    <button id="googleLoginBtn" class="login-button" type="button">
      <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google"
           onerror="this.style.display='none'">
      Google ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸
    </button>
  </div>

  <div id="appContainer">
    <div class="user-profile">
      <img id="userAvatar"
           src="https://placehold.co/36x36/E0E0E0/B0B0B0?text=User"
           alt="User Avatar"
           class="user-avatar"
           onerror="this.src='https://placehold.co/36x36/E0E0E0/B0B0B0?text=User'">

      <div class="user-info">
        <div id="userName" class="user-name"></div>
        <div id="userEmail" class="user-email"></div>
      </div>

      <button id="logoutBtn" class="logout-button" type="button">ë¡œê·¸ì•„ì›ƒ</button>
    </div>

    <div class="tabs">
      <button class="tab active" data-view="add" type="button">ìƒˆ ë‰´ìŠ¤ ì¶”ê°€</button>
      <button class="tab" data-view="tags" type="button">íƒœê·¸</button>
      <button class="tab" data-view="list" type="button">ëª©ë¡ ë³´ê¸°</button>
      <button class="tab" data-view="clusters" type="button">ì—°ê´€ ë‰´ìŠ¤</button>
      <button class="tab" data-view="timeline" type="button">íƒ€ì„ë¼ì¸</button>
    </div>

    <div id="addView" class="view-container active">
      <div class="form-container">
        <div class="form-row">
          <div class="form-group">
            <label for="titleInput">ë‰´ìŠ¤ ì œëª©</label>
            <input type="text" id="titleInput" placeholder="ë‰´ìŠ¤ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="urlInput">URL</label>
            <input type="url" id="urlInput" placeholder="https://">
          </div>

          <div class="form-group">
            <label for="dateInput">ë‚ ì§œ</label>
            <input type="date" id="dateInput">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="tagsInput">íƒœê·¸</label>
            <div class="tags-input" id="tagsContainer">
              <input type="text" id="tagInput" placeholder="íƒœê·¸ ì…ë ¥ í›„ Enter">
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="noteInput">ë©”ëª¨</label>
            <textarea id="noteInput" placeholder="ì¶”ê°€ ë©”ëª¨..."></textarea>
          </div>
        </div>

        <div class="form-row">
          <button id="addNewsBtn" class="primary" type="button">ì €ì¥í•˜ê¸°</button>
        </div>
      </div>
    </div>

    <div id="tagsView" class="view-container">
      <div class="tags-list" id="tagsList"></div>
    </div>

    <div id="listView" class="view-container">
      <div class="news-filters">
        <div class="filter-group">
          <label for="tagFilter">íƒœê·¸</label>
          <select id="tagFilter">
            <option value="">ì „ì²´</option>
          </select>
        </div>

        <div class="filter-group">
          <label for="dateFilter">ê¸°ê°„</label>
          <select id="dateFilter">
            <option value="">ì „ì²´</option>
            <option value="7">ìµœê·¼ 7ì¼</option>
            <option value="30">ìµœê·¼ 30ì¼</option>
            <option value="90">ìµœê·¼ 3ê°œì›”</option>
            <option value="365">ìµœê·¼ 1ë…„</option>
          </select>
        </div>

        <div class="filter-group">
          <label for="searchInput">ê²€ìƒ‰</label>
          <input type="text" id="searchInput" placeholder="í‚¤ì›Œë“œ ê²€ìƒ‰..." style="min-width: 150px;">
        </div>

        <div class="filter-group" style="margin-left: auto;">
          <button id="downloadCsvBtn" class="primary" type="button" style="padding: 0.6rem 1rem; font-size: 0.9rem;">
            CSV ë‹¤ìš´ë¡œë“œ
          </button>
        </div>
      </div>

      <div id="newsList" class="news-list"></div>
    </div>

    <div id="clustersView" class="view-container">
      <div class="clusters-container" id="newsClusters"></div>
    </div>

    <div id="timelineView" class="view-container">
      <div class="timeline-filters">
        <div class="filter-group">
          <label for="timelineTagFilter">íƒœê·¸ í•„í„°</label>
          <select id="timelineTagFilter">
            <option value="">ì „ì²´</option>
          </select>
        </div>
      </div>
      <div class="timeline" id="newsTimeline"></div>
    </div>
  </div>

  <script>
    function goHome() {
      // í˜„ì¬ íŒŒì¼ì´ it-news-insight/ ì•ˆì— ìˆë‹¤ë©´ ../ ë¡œ ë©”ì¸ ì´ë™
      // ê°™ì€ í´ë” êµ¬ì¡°ê°€ ì•„ë‹ˆë©´ ì—¬ê¸°ë§Œ ë§ì¶°ì„œ ë³€ê²½
      window.location.href = "../";
    }
    function scrollToTop() {
      window.scrollTo({ top: 0, behavior: "smooth" });
    }
  </script>

  <script type="module">
    /* Firebase SDK ë¡œë“œ */
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-app.js";
    import { getDatabase, ref, push, onValue, remove, update } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-database.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-auth.js";

    /* Firebase ì„¤ì • */
    const firebaseConfig = {
      apiKey: "AIzaSyAd08tVXgWZ2_dg3jzvhawmH4jtolRmfhY",
      authDomain: "itnews-82b60.firebaseapp.com",
      databaseURL: "https://itnews-82b60-default-rtdb.firebaseio.com",
      projectId: "itnews-82b60",
      storageBucket: "itnews-82b60.appspot.com",
      messagingSenderId: "719267588761",
      appId: "1:719267588761:web:3c4607cb799620f9446608"
    };

    /* í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ (ëŒ€í‘œë‹˜ ê³„ì •ë§Œ í—ˆìš©) */
    const ALLOWED_EMAILS = new Set(["eundang@gmail.com"]);

    /* ì´ˆê¸°í™” */
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();

    // í˜„ì¬ ì‚¬ìš©ì
    let currentUserId = null;
    let currentUser = null;

    /* DOM ìš”ì†Œ */
    // ë¡œê·¸ì¸ ê´€ë ¨
    const loginContainer = document.getElementById("loginContainer");
    const appContainer = document.getElementById("appContainer");
    const googleLoginBtn = document.getElementById("googleLoginBtn");
    const logoutBtn = document.getElementById("logoutBtn");
    const userAvatar = document.getElementById("userAvatar");
    const userName = document.getElementById("userName");
    const userEmail = document.getElementById("userEmail");

    // íƒ­ ê´€ë ¨
    const tabs = document.querySelectorAll(".tab");
    const viewContainers = document.querySelectorAll(".view-container");

    // í¼ ìš”ì†Œ
    const titleInput = document.getElementById("titleInput");
    const urlInput = document.getElementById("urlInput");
    const dateInput = document.getElementById("dateInput");
    const tagsContainer = document.getElementById("tagsContainer");
    const tagInput = document.getElementById("tagInput");
    const noteInput = document.getElementById("noteInput");
    const addNewsBtn = document.getElementById("addNewsBtn");

    // ëª©ë¡ ë° í•„í„° ìš”ì†Œ
    const newsList = document.getElementById("newsList");
    const tagFilter = document.getElementById("tagFilter");
    const dateFilter = document.getElementById("dateFilter");
    const searchInput = document.getElementById("searchInput");
    const downloadCsvBtn = document.getElementById("downloadCsvBtn");

    // íƒ€ì„ë¼ì¸ ë° í´ëŸ¬ìŠ¤í„° ìš”ì†Œ
    const newsTimeline = document.getElementById("newsTimeline");
    const newsClusters = document.getElementById("newsClusters");
    const timelineTagFilter = document.getElementById("timelineTagFilter");

    // íƒœê·¸ ë·° ìš”ì†Œ
    const tagsList = document.getElementById("tagsList");

    /* ìƒíƒœ */
    let allNewsData = [];
    let userTags = new Set();

    /* ë‚ ì§œ ê¸°ë³¸ê°’ì„ ì˜¤ëŠ˜ë¡œ ì„¤ì • */
    dateInput.valueAsDate = new Date();

    /* ìœ í‹¸ */
    function safeText(s) {
      return String(s ?? "")
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    /* êµ¬ê¸€ ë¡œê·¸ì¸ */
    googleLoginBtn.addEventListener("click", async () => {
      try {
        const result = await signInWithPopup(auth, provider);
        const user = result.user;

        // ë¡œê·¸ì¸ ì§í›„ í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ ì²´í¬
        if (!user?.email || !ALLOWED_EMAILS.has(user.email)) {
          alert("í—ˆìš©ë˜ì§€ ì•Šì€ ê³„ì •ì…ë‹ˆë‹¤. eundang@gmail.comìœ¼ë¡œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.");
          await signOut(auth);
          return;
        }
        // ì„±ê³µì‹œ onAuthStateChangedê°€ ì´ì–´ì„œ ì²˜ë¦¬
      } catch (error) {
        console.error("ë¡œê·¸ì¸ ì‹¤íŒ¨:", error);
        alert("ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
      }
    });

    /* ë¡œê·¸ì•„ì›ƒ */
    logoutBtn.addEventListener("click", async () => {
      try {
        await signOut(auth);
      } catch (error) {
        console.error("ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨:", error);
        alert("ë¡œê·¸ì•„ì›ƒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
      }
    });

    /* ì¸ì¦ ìƒíƒœ ë³€ê²½ ê°ì§€ */
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        // í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ ì¬ê²€ì¦ (ì„¸ì…˜ ë³µì›/ìë™ë¡œê·¸ì¸ ëŒ€ë¹„)
        if (!user.email || !ALLOWED_EMAILS.has(user.email)) {
          alert("í—ˆìš©ë˜ì§€ ì•Šì€ ê³„ì •ì…ë‹ˆë‹¤. eundang@gmail.comìœ¼ë¡œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.");
          await signOut(auth);
          return;
        }

        currentUser = user;
        currentUserId = user.uid;

        // ì‚¬ìš©ì ì •ë³´ í‘œì‹œ
        userAvatar.src = user.photoURL || "https://placehold.co/36x36/E0E0E0/B0B0B0?text=User";
        userName.textContent = user.displayName || "ì‚¬ìš©ì";
        userEmail.textContent = user.email || "";

        // UI ì „í™˜
        loginContainer.style.display = "none";
        appContainer.style.display = "block";

        // ë°ì´í„° ë¡œë“œ
        loadNewsData();
      } else {
        currentUser = null;
        currentUserId = null;

        // UI ì „í™˜
        loginContainer.style.display = "block";
        appContainer.style.display = "none";

        // ë°ì´í„° ì´ˆê¸°í™”
        allNewsData = [];
        userTags = new Set();
        newsList.innerHTML = "";
        newsTimeline.innerHTML = "";
        newsClusters.innerHTML = "";
        tagsList.innerHTML = "";
      }
    });

    /* íƒœê·¸ ì…ë ¥ ì²˜ë¦¬ */
    const tags = []; // í˜„ì¬ ì…ë ¥ ì¤‘ì¸ ë‰´ìŠ¤ ì•„ì´í…œì˜ íƒœê·¸

    tagInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && tagInput.value.trim()) {
        e.preventDefault();
        const tagValue = tagInput.value.trim().toLowerCase();
        if (tagValue && !tags.includes(tagValue)) {
          tags.push(tagValue);
          renderInputTags();
          tagInput.value = "";
        }
      }
    });

    function renderInputTags() {
      // ê¸°ì¡´ íƒœê·¸ ì—˜ë¦¬ë¨¼íŠ¸ ì œê±° (input ì œì™¸)
      tagsContainer.querySelectorAll(".tag").forEach((el) => el.remove());

      tags.forEach((tag, index) => {
        const tagEl = document.createElement("div");
        tagEl.className = "tag";
        tagEl.innerHTML = `
          ${safeText(tag)}
          <span class="tag-remove" data-index="${index}" role="button" aria-label="Remove tag ${safeText(tag)}">Ã—</span>
        `;

        tagEl.querySelector(".tag-remove").addEventListener("click", () => {
          tags.splice(index, 1);
          renderInputTags();
        });

        tagsContainer.insertBefore(tagEl, tagInput);
      });
    }

    /* ë‰´ìŠ¤ ì¶”ê°€ */
    async function addNewsHandler() {
      if (!currentUserId) {
        alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
        return;
      }

      const title = titleInput.value.trim();
      const url = urlInput.value.trim();
      const date = dateInput.value;
      const note = noteInput.value.trim();

      if (!title || !url || !date) {
        alert("ì œëª©, URL, ë‚ ì§œëŠ” í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤.");
        return;
      }

      try {
        new URL(url);
      } catch (_) {
        alert("ìœ íš¨í•œ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”. (ì˜ˆ: https://example.com)");
        return;
      }

      const newsData = {
        title,
        url,
        date,
        tags: [...tags].map((t) => t.toLowerCase()),
        note,
        timestamp: Date.now(),
        userId: currentUserId
      };

      try {
        await push(ref(db, `users/${currentUserId}/news`), newsData);

        // í¼ ì´ˆê¸°í™”
        titleInput.value = "";
        urlInput.value = "";
        dateInput.valueAsDate = new Date();
        tags.length = 0;
        renderInputTags();
        noteInput.value = "";

        switchTab("list");
      } catch (error) {
        console.error("ì €ì¥ ì¤‘ ì˜¤ë¥˜:", error);
        alert("ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: " + error.message);
      }
    }

    addNewsBtn.addEventListener("click", addNewsHandler);

    /* íƒ­ ì „í™˜ */
    tabs.forEach((tab) => {
      tab.addEventListener("click", () => {
        const viewName = tab.dataset.view;
        switchTab(viewName);
      });
    });

    function switchTab(viewName) {
      tabs.forEach((tab) => {
        tab.classList.toggle("active", tab.dataset.view === viewName);
      });

      viewContainers.forEach((container) => {
        container.classList.toggle("active", container.id === `${viewName}View`);
      });

      if (viewName === "list") renderNewsList();
      if (viewName === "timeline") renderTimeline();
      if (viewName === "clusters") renderClusters();
      if (viewName === "tags") renderTagsList();
    }

    /* ë‰´ìŠ¤ ë°ì´í„° ë¡œë“œ */
    function loadNewsData() {
      if (!currentUserId) return;

      const newsRef = ref(db, `users/${currentUserId}/news`);

      onValue(newsRef, (snapshot) => {
        allNewsData = [];
        userTags = new Set();

        snapshot.forEach((childSnapshot) => {
          const v = childSnapshot.val();
          const newsItem = { id: childSnapshot.key, ...v };
          allNewsData.push(newsItem);

          if (newsItem.tags && Array.isArray(newsItem.tags)) {
            newsItem.tags.forEach((tag) => userTags.add(String(tag).toLowerCase()));
          }
        });

        // ë‚ ì§œ ë‚´ë¦¼ì°¨ìˆœ
        allNewsData.sort((a, b) => new Date(b.date) - new Date(a.date));

        updateTagFilters();

        const activeView = document.querySelector(".view-container.active")?.id?.replace("View", "");
        if (activeView) {
          if (activeView === "list") renderNewsList();
          else if (activeView === "timeline") renderTimeline();
          else if (activeView === "clusters") renderClusters();
          else if (activeView === "tags") renderTagsList();
        } else {
          renderNewsList();
        }
      });
    }

    /* íƒœê·¸ í•„í„° ì—…ë°ì´íŠ¸ */
    function updateTagFilters() {
      const sortedTags = Array.from(userTags).sort();

      tagFilter.innerHTML = '<option value="">ì „ì²´</option>';
      sortedTags.forEach((tag) => {
        const option = document.createElement("option");
        option.value = tag;
        option.textContent = tag;
        tagFilter.appendChild(option);
      });

      timelineTagFilter.innerHTML = '<option value="">ì „ì²´</option>';
      sortedTags.forEach((tag) => {
        const option = document.createElement("option");
        option.value = tag;
        option.textContent = tag;
        timelineTagFilter.appendChild(option);
      });
    }

    /* ë‰´ìŠ¤ ëª©ë¡ ë Œë” */
    function renderNewsList() {
      const selectedTag = tagFilter.value;
      const selectedDateRange = dateFilter.value;
      const searchKeyword = searchInput.value.toLowerCase().trim();

      let filteredNews = [...allNewsData];

      if (selectedTag) {
        filteredNews = filteredNews.filter((news) => news.tags && news.tags.includes(selectedTag));
      }

      if (selectedDateRange) {
        const today = new Date();
        const daysAgo = new Date(today);
        daysAgo.setDate(today.getDate() - parseInt(selectedDateRange, 10));

        filteredNews = filteredNews.filter((news) => {
          const nd = new Date(news.date);
          return nd >= daysAgo && nd <= today;
        });
      }

      if (searchKeyword) {
        filteredNews = filteredNews.filter((news) => {
          const title = String(news.title || "").toLowerCase();
          const note = String(news.note || "").toLowerCase();
          const tagsArr = Array.isArray(news.tags) ? news.tags : [];
          return (
            title.includes(searchKeyword) ||
            note.includes(searchKeyword) ||
            tagsArr.some((t) => String(t).toLowerCase().includes(searchKeyword))
          );
        });
      }

      newsList.innerHTML = "";

      if (filteredNews.length === 0) {
        newsList.innerHTML = '<div class="empty-message">í‘œì‹œí•  ë‰´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
      }

      filteredNews.forEach((news) => {
        const newsItemEl = document.createElement("div");
        newsItemEl.className = "news-item";

        const formattedDate = new Date(news.date).toLocaleDateString("ko-KR", {
          year: "numeric",
          month: "long",
          day: "numeric"
        });

        const noteHtml = news.note
          ? `<div class="news-note">${safeText(news.note).replace(/\n/g, "<br>")}</div>`
          : "";

        const tagsHtml = Array.isArray(news.tags)
          ? news.tags.map((tag) => `<span class="news-tag" role="button" data-tag="${safeText(tag)}">${safeText(tag)}</span>`).join("")
          : "";

        newsItemEl.innerHTML = `
          <div class="news-date">${formattedDate}</div>
          <h3 class="news-title">${safeText(news.title)}</h3>
          <a href="${safeText(news.url)}" target="_blank" rel="noopener noreferrer" class="news-url">${safeText(news.url)}</a>
          ${noteHtml}
          <div class="news-tags">${tagsHtml}</div>
          <div class="news-actions">
            <button class="action-btn edit-btn" data-id="${safeText(news.id)}" type="button">ìˆ˜ì •</button>
            <button class="action-btn delete-btn" data-id="${safeText(news.id)}" type="button">ì‚­ì œ</button>
          </div>
        `;

        // íƒœê·¸ í´ë¦­ -> ëª©ë¡ íƒœê·¸ í•„í„° ì ìš©
        newsItemEl.querySelectorAll(".news-tag").forEach((tagEl) => {
          tagEl.addEventListener("click", () => {
            tagFilter.value = tagEl.dataset.tag;
            switchTab("list");
            renderNewsList();
          });
        });

        // ì‚­ì œ
        newsItemEl.querySelector(".delete-btn").addEventListener("click", async () => {
          if (confirm(`'${news.title}' ë‰´ìŠ¤ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
            await deleteNews(news.id);
          }
        });

        // ìˆ˜ì •: í˜„ì¬ëŠ” ë¯¸êµ¬í˜„ (ì›í•˜ì‹œë©´ ë‹¤ìŒ ìŠ¤í…ì—ì„œ ë¶™ì…ë‹ˆë‹¤)
        newsItemEl.querySelector(".edit-btn").addEventListener("click", () => {
          alert("ìˆ˜ì • ê¸°ëŠ¥ì€ ë‹¤ìŒ ìŠ¤í…ì—ì„œ ë¶™ì´ë©´ ë©ë‹ˆë‹¤. (ëª¨ë‹¬ë¡œ í¸ì§‘/ì €ì¥)");
        });

        newsList.appendChild(newsItemEl);
      });
    }

    /* ë‰´ìŠ¤ ì‚­ì œ */
    async function deleteNews(newsId) {
      if (!currentUserId) return;
      try {
        await remove(ref(db, `users/${currentUserId}/news/${newsId}`));
      } catch (error) {
        console.error("ì‚­ì œ ì¤‘ ì˜¤ë¥˜:", error);
        alert("ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: " + error.message);
      }
    }

    /* íƒ€ì„ë¼ì¸ ë Œë” */
    function renderTimeline() {
      const selectedTag = timelineTagFilter.value;
      let filteredNews = [...allNewsData];

      if (selectedTag) {
        filteredNews = filteredNews.filter((news) => news.tags && news.tags.includes(selectedTag));
      }

      newsTimeline.innerHTML = "";

      if (filteredNews.length === 0) {
        newsTimeline.innerHTML = '<div class="empty-message">í‘œì‹œí•  íƒ€ì„ë¼ì¸ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
      }

      filteredNews.forEach((news) => {
        const timelineItem = document.createElement("div");
        timelineItem.className = "timeline-item";

        const formattedDate = new Date(news.date).toLocaleDateString("ko-KR", {
          year: "numeric",
          month: "long",
          day: "numeric"
        });

        const noteHtml = news.note
          ? `<div class="news-note">${safeText(news.note).replace(/\n/g, "<br>")}</div>`
          : "";

        const tagsHtml = Array.isArray(news.tags)
          ? news.tags.map((tag) => `<span class="news-tag" role="button" data-tag="${safeText(tag)}">${safeText(tag)}</span>`).join("")
          : "";

        timelineItem.innerHTML = `
          <div class="timeline-dot"></div>
          <div class="timeline-content">
            <div class="news-date">${formattedDate}</div>
            <h3 class="news-title">${safeText(news.title)}</h3>
            <a href="${safeText(news.url)}" target="_blank" rel="noopener noreferrer" class="news-url">${safeText(news.url)}</a>
            ${noteHtml}
            <div class="news-tags">${tagsHtml}</div>
          </div>
        `;

        timelineItem.querySelectorAll(".news-tag").forEach((tagEl) => {
          tagEl.addEventListener("click", () => {
            timelineTagFilter.value = tagEl.dataset.tag;
            switchTab("timeline");
            renderTimeline();
          });
        });

        newsTimeline.appendChild(timelineItem);
      });
    }

    /* ì—°ê´€ ë‰´ìŠ¤ í´ëŸ¬ìŠ¤í„° */
    function renderClusters() {
      if (allNewsData.length === 0) {
        newsClusters.innerHTML = '<div class="empty-message">ì—°ê´€ ë‰´ìŠ¤ë¥¼ ê³„ì‚°í•  í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
      }

      const clusters = {};
      allNewsData.forEach((news) => {
        if (Array.isArray(news.tags) && news.tags.length > 0) {
          news.tags.forEach((tag) => {
            const lowerTag = String(tag).toLowerCase();
            if (!clusters[lowerTag]) clusters[lowerTag] = [];
            clusters[lowerTag].push(news);
          });
        }
      });

      newsClusters.innerHTML = "";
      let hasVisibleClusters = false;

      const sortedClusterTags = Object.keys(clusters).sort();

      for (const tag of sortedClusterTags) {
        if (clusters[tag].length < 2) continue;
        hasVisibleClusters = true;

        const clusterEl = document.createElement("div");
        clusterEl.className = "cluster";
        clusterEl.innerHTML = `
          <h3 class="cluster-title">${safeText(tag)} ê´€ë ¨ ë‰´ìŠ¤ (${clusters[tag].length})</h3>
          <div class="cluster-items"></div>
        `;

        const clusterItems = clusterEl.querySelector(".cluster-items");

        clusters[tag].sort((a, b) => new Date(b.date) - new Date(a.date));

        clusters[tag].forEach((news) => {
          const newsItemEl = document.createElement("div");
          newsItemEl.className = "news-item";

          const formattedDate = new Date(news.date).toLocaleDateString("ko-KR", {
            year: "numeric",
            month: "long",
            day: "numeric"
          });

          const previewNote = news.note ? String(news.note) : "";
          const preview = previewNote.length > 120 ? previewNote.slice(0, 120) + "..." : previewNote;

          newsItemEl.innerHTML = `
            <div class="news-date">${formattedDate}</div>
            <h4 class="news-title">${safeText(news.title)}</h4>
            <a href="${safeText(news.url)}" target="_blank" rel="noopener noreferrer" class="news-url">${safeText(news.url)}</a>
            ${preview ? `<div class="news-note" style="font-size:0.85rem">${safeText(preview)}</div>` : ""}
          `;

          clusterItems.appendChild(newsItemEl);
        });

        newsClusters.appendChild(clusterEl);
      }

      if (!hasVisibleClusters) {
        newsClusters.innerHTML = '<div class="empty-message">ì—°ê´€ ë‰´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤. ì—¬ëŸ¬ ë‰´ìŠ¤ì— ë™ì¼í•œ íƒœê·¸ë¥¼ ì¶”ê°€í•´ ë³´ì„¸ìš”.</div>';
      }
    }

    /* íƒœê·¸ ê´€ë¦¬ ë·° */
    function renderTagsList() {
      tagsList.innerHTML = "";

      if (userTags.size === 0) {
        tagsList.innerHTML = '<div class="empty-message">ìƒì„±ëœ íƒœê·¸ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
      }

      const tagUsage = {};
      Array.from(userTags).forEach((tag) => {
        tagUsage[tag] = allNewsData.filter((news) => Array.isArray(news.tags) && news.tags.includes(tag)).length;
      });

      const sortedTags = Array.from(userTags).sort();

      sortedTags.forEach((tag) => {
        const tagItem = document.createElement("div");
        tagItem.className = "tag-item";
        tagItem.innerHTML = `
          <div>
            <span class="tag-name">${safeText(tag)}</span>
            <span class="tag-count">(${tagUsage[tag]})</span>
          </div>
          <button class="tag-delete-btn" data-tag="${safeText(tag)}" type="button">ì‚­ì œ</button>
        `;

        tagItem.querySelector(".tag-delete-btn").addEventListener("click", async () => {
          if (confirm(`'${tag}' íƒœê·¸ë¥¼ ëª¨ë“  ë‰´ìŠ¤ì—ì„œ ì œê±°í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`)) {
            await removeTagFromAllNews(tag);
          }
        });

        tagsList.appendChild(tagItem);
      });
    }

    /* ëª¨ë“  ë‰´ìŠ¤ì—ì„œ íŠ¹ì • íƒœê·¸ ì œê±° */
    async function removeTagFromAllNews(tagToRemove) {
      if (!currentUserId) return;

      const updatesObj = {};

      allNewsData.forEach((news) => {
        if (Array.isArray(news.tags) && news.tags.includes(tagToRemove)) {
          const updatedTags = news.tags.filter((t) => t !== tagToRemove);
          // tagsê°€ ë¹„ë©´ tags í•„ë“œ ì œê±°(null)
          updatesObj[`users/${currentUserId}/news/${news.id}/tags`] = updatedTags.length > 0 ? updatedTags : null;
        }
      });

      if (Object.keys(updatesObj).length === 0) return;

      try {
        // rootì— ëŒ€í•´ multi-path update
        await update(ref(db), updatesObj);
      } catch (error) {
        console.error("íƒœê·¸ ì œê±° ì¤‘ ì˜¤ë¥˜:", error);
        alert("íƒœê·¸ ì œê±° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: " + error.message);
      }
    }

    /* CSV */
    function escapeCSVField(field) {
      if (field === null || typeof field === "undefined") return "";
      let stringField = String(field);
      if (stringField.includes(",") || stringField.includes("\n") || stringField.includes('"')) {
        stringField = stringField.replace(/"/g, '""');
        return `"${stringField}"`;
      }
      return stringField;
    }

    function convertToCSV(newsArray) {
      const headers = ["ì œëª©", "URL", "ë‚ ì§œ", "íƒœê·¸", "ë©”ëª¨"];
      const csvHeader = headers.map(escapeCSVField).join(",");
      const csvRows = [csvHeader];

      newsArray.forEach((news) => {
        const tagsString = Array.isArray(news.tags) ? news.tags.join("; ") : "";
        const row = [
          escapeCSVField(news.title),
          escapeCSVField(news.url),
          escapeCSVField(news.date),
          escapeCSVField(tagsString),
          escapeCSVField(news.note || "")
        ];
        csvRows.push(row.join(","));
      });

      return csvRows.join("\n");
    }

    downloadCsvBtn.addEventListener("click", () => {
      if (!currentUserId) {
        alert("CSVë¥¼ ë‹¤ìš´ë¡œë“œí•˜ë ¤ë©´ ë¨¼ì € ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.");
        return;
      }
      if (allNewsData.length === 0) {
        alert("ë‹¤ìš´ë¡œë“œí•  ë‰´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤.");
        return;
      }

      // í˜„ì¬ í•„í„° ìƒíƒœ ê·¸ëŒ€ë¡œ ì¬ì ìš©
      const selectedTag = tagFilter.value;
      const selectedDateRange = dateFilter.value;
      const searchKeyword = searchInput.value.toLowerCase().trim();

      let newsToExport = [...allNewsData];

      if (selectedTag) {
        newsToExport = newsToExport.filter((news) => Array.isArray(news.tags) && news.tags.includes(selectedTag));
      }

      if (selectedDateRange) {
        const today = new Date();
        const daysAgo = new Date(today);
        daysAgo.setDate(today.getDate() - parseInt(selectedDateRange, 10));
        newsToExport = newsToExport.filter((news) => {
          const nd = new Date(news.date);
          return nd >= daysAgo && nd <= today;
        });
      }

      if (searchKeyword) {
        newsToExport = newsToExport.filter((news) => {
          const title = String(news.title || "").toLowerCase();
          const note = String(news.note || "").toLowerCase();
          const tagsArr = Array.isArray(news.tags) ? news.tags : [];
          return (
            title.includes(searchKeyword) ||
            note.includes(searchKeyword) ||
            tagsArr.some((t) => String(t).toLowerCase().includes(searchKeyword))
          );
        });
      }

      if (newsToExport.length === 0) {
        alert("í˜„ì¬ í•„í„° ì¡°ê±´ì— ë§ëŠ” ë‰´ìŠ¤ê°€ ì—†ì–´ CSVë¡œ ë‹¤ìš´ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        return;
      }

      const csvData = convertToCSV(newsToExport);
      const blob = new Blob(["\uFEFF" + csvData], { type: "text/csv;charset=utf-8;" });
      const objectUrl = URL.createObjectURL(blob);

      const link = document.createElement("a");
      link.setAttribute("href", objectUrl);

      const now = new Date();
      const timestamp = `${now.getFullYear()}${String(now.getMonth() + 1).padStart(2, "0")}${String(now.getDate()).padStart(2, "0")}_${String(now.getHours()).padStart(2, "0")}${String(now.getMinutes()).padStart(2, "0")}`;
      link.setAttribute("download", `it_news_export_${timestamp}.csv`);

      link.style.visibility = "hidden";
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(objectUrl);
    });

    /* í•„í„° ë³€ê²½ ì´ë²¤íŠ¸ */
    tagFilter.addEventListener("change", renderNewsList);
    dateFilter.addEventListener("change", renderNewsList);
    searchInput.addEventListener("input", renderNewsList);
    timelineTagFilter.addEventListener("change", renderTimeline);

    /* ì´ˆê¸° */
    renderInputTags();
    // ë°ì´í„° ë¡œë“œëŠ” onAuthStateChangedì—ì„œ ìˆ˜í–‰
  </script>
</body>
</html>
